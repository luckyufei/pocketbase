# åŒæ•°æ®åº“æµ‹è¯•è¦†ç›–æ”¹è¿›ä»»åŠ¡æ¸…å•ï¼ˆå®Œæ•´ç‰ˆï¼‰

> **å…³è”è®¡åˆ’**: [plan.md](./plan.md)  
> **ç›®æ ‡**: PostgreSQL æµ‹è¯•è¦†ç›–ç‡ä» 5.3% â†’ 100%  
> **å½“å‰è¿›åº¦**: 240/1549 (15.5%) â¬†ï¸

## çŠ¶æ€å›¾ä¾‹

- ğŸ”´ å¾…å¼€å§‹
- ğŸŸ¡ è¿›è¡Œä¸­  
- ğŸŸ¢ å·²å®Œæˆ
- âšª å·²è·³è¿‡ï¼ˆä¸éœ€è¦ï¼‰

---

## é˜¶æ®µä¸€ï¼šCore æ¨¡å— (788 æµ‹è¯•å‡½æ•°)

### 1.1 æ•°æ®åº“æ ¸å¿ƒæµ‹è¯• ğŸŸ¢

| # | æ–‡ä»¶ | æµ‹è¯•å‡½æ•°æ•° | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|------|-----------|------|---------|
| 1.1.1 | `record_model_test.go` | 14 (DBç›¸å…³) | ğŸŸ¢ | 2026-01-30 |
| 1.1.2 | `collection_model_test.go` | 7 (DBç›¸å…³) | ğŸŸ¢ | 2026-01-30 |
| 1.1.3 | `record_query_test.go` | 13 | ğŸŸ¢ | 2026-01-30 |
| 1.1.4 | `db_test.go` | 3 (DBç›¸å…³) | ğŸŸ¢ | 2026-01-30 |
| 1.1.5 | `log_query_test.go` | 3 | ğŸŸ¢ | 2026-01-30 |
| 1.1.6 | `base_test.go` | 4 (DBç›¸å…³) | ğŸŸ¢ | 2026-01-30 |
| 1.1.7 | `db_tx_test.go` | 6 | ğŸŸ¢ | 2026-01-30 |
| 1.1.8 | `collection_query_test.go` | 9 | ğŸŸ¢ | 2026-01-30 |
| 1.1.9 | `db_table_test.go` | 10 | ğŸŸ¢ | 2026-01-30 |

**å°è®¡**: ~225 æµ‹è¯•å‡½æ•°ï¼ˆå·²å®Œæˆ 69ï¼‰

**é‡è¦ä¿®å¤ï¼ˆ1.1.9ï¼‰**:
- ä¿®å¤ `BaseApp.TableInfo()` ç›´æ¥ä½¿ç”¨ `app.ConcurrentDB()` æŸ¥è¯¢ PostgreSQLï¼Œé¿å… DBAdapter è¿æ¥æœªåˆå§‹åŒ–é—®é¢˜
- ä¿®å¤ `BaseApp.TableColumns()` å’Œ `BaseApp.TableIndexes()` ä½¿ç”¨ç›¸åŒæ¨¡å¼
- ä¿®å¤ `BaseApp.Vacuum()` æ”¯æŒ PostgreSQL çš„ `VACUUM ANALYZE`
- æ›´æ–°æµ‹è¯•æœŸæœ›å€¼ä»¥åŒ¹é…å®é™…çš„ PostgreSQL è¡¨ç»“æ„

---

### 1.2 å­—æ®µç±»å‹æµ‹è¯• ğŸŸ¡

| # | æ–‡ä»¶ | æµ‹è¯•å‡½æ•°æ•° | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|------|-----------|------|---------|
| 1.2.1 | `field_text_test.go` | 7 | ğŸŸ¢ | 2026-01-30 |
| 1.2.2 | `field_number_test.go` | 6 | ğŸŸ¢ | 2026-01-30 |
| 1.2.3 | `field_bool_test.go` | 5 | ğŸŸ¢ | 2026-01-30 |
| 1.2.4 | `field_date_test.go` | 5 | ğŸŸ¢ | 2026-01-30 |
| 1.2.5 | `field_file_test.go` | 12 | ğŸŸ¢ | 2026-01-30 |
| 1.2.6 | `field_relation_test.go` | ~25 | ğŸ”´ | - |
| 1.2.7 | `field_select_test.go` | 6 | ğŸŸ¢ | 2026-01-30 |
| 1.2.8 | `field_json_test.go` | 6 | ğŸŸ¢ | 2026-01-30 |
| 1.2.9 | `field_email_test.go` | 4 | ğŸŸ¢ | 2026-01-30 |
| 1.2.10 | `field_url_test.go` | 4 | ğŸŸ¢ | 2026-01-30 |
| 1.2.11 | `field_editor_test.go` | 5 | ğŸŸ¢ | 2026-01-30 |
| 1.2.12 | `field_autodate_test.go` | ~10 | ğŸ”´ | - |
| 1.2.13 | `field_geo_point_test.go` | ~10 | ğŸ”´ | - |
| 1.2.14 | `field_password_test.go` | ~15 | ğŸ”´ | - |
| 1.2.15 | `field_secret_test.go` | ~10 | ğŸ”´ | - |

**å°è®¡**: ~200 æµ‹è¯•å‡½æ•°

**å·²è¿ç§»æµ‹è¯• (1.2.1)**:
- `TestTextFieldBaseMethods` - æ— éœ€è¿ç§»ï¼ˆä¸è®¿é—®æ•°æ®åº“ï¼‰
- `TestTextFieldColumnType` - è¿ç§»åˆ° `DualDBTest`ï¼Œæ”¯æŒ SQLite/PostgreSQL ä¸åŒ PRIMARY KEY è¯­æ³•
- `TestTextFieldPrepareValue` - è¿ç§»åˆ° `DualDBTest`
- `TestTextFieldValidateValue` - è¿ç§»åˆ° `DualDBTest`ï¼Œ29 ä¸ªå­æµ‹è¯•åœºæ™¯
- `TestTextFieldValidateSettings` - è¿ç§»åˆ° `DualDBTest`ï¼ŒåŒ…å« `testDefaultFieldIdValidationWithApp` å’Œ `testDefaultFieldNameValidationWithApp`
- `TestTextFieldAutogenerate` - è¿ç§»åˆ° `DualDBTest`
- `TestTextFieldFindSetter` - æ— éœ€è¿ç§»ï¼ˆä¸è®¿é—®æ•°æ®åº“ï¼‰

**æ–°å¢è¾…åŠ©å‡½æ•°** (`field_test.go`):
- `testDefaultFieldIdValidationWithApp(t, app, fieldType)` - ç”¨äº DualDBTest å†…éƒ¨
- `testDefaultFieldNameValidationWithApp(t, app, fieldType)` - ç”¨äº DualDBTest å†…éƒ¨

---

### 1.3 è®¤è¯ç›¸å…³æµ‹è¯• ğŸ”´

| # | æ–‡ä»¶ | æµ‹è¯•å‡½æ•°æ•° | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|------|-----------|------|---------|
| 1.3.1 | `auth_origin_query_test.go` | ~15 | ğŸ”´ | - |
| 1.3.2 | `external_auth_query_test.go` | ~20 | ğŸ”´ | - |
| 1.3.3 | `mfa_query_test.go` | ~15 | ğŸ”´ | - |
| 1.3.4 | `otp_query_test.go` | ~15 | ğŸ”´ | - |
| 1.3.5 | `record_token_test.go` | ~20 | ğŸ”´ | - |

**å°è®¡**: ~85 æµ‹è¯•å‡½æ•°

---

### 1.4 å…¶ä»– Core æµ‹è¯• ğŸ”´

| # | æ–‡ä»¶ | æµ‹è¯•å‡½æ•°æ•° | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|------|-----------|------|---------|
| 1.4.1 | `events_test.go` | ~30 | ğŸ”´ | - |
| 1.4.2 | `validators/*_test.go` | ~50 | ğŸ”´ | - |
| 1.4.3 | `record_expand_test.go` | ~25 | ğŸ”´ | - |
| 1.4.4 | `collection_query_test.go` | ~20 | ğŸ”´ | - |
| 1.4.5 | `settings_test.go` | ~15 | ğŸ”´ | - |
| 1.4.6 | å…¶ä»– | ~138 | ğŸ”´ | - |

**å°è®¡**: ~278 æµ‹è¯•å‡½æ•°

---

**é˜¶æ®µä¸€æ€»è®¡**: 788 æµ‹è¯•å‡½æ•°

---

## é˜¶æ®µäºŒï¼šAPIs æ¨¡å— (170 æµ‹è¯•å‡½æ•°)

### 2.1 CRUD æµ‹è¯• ğŸ”´

| # | æ–‡ä»¶ | æµ‹è¯•å‡½æ•°æ•° | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|------|-----------|------|---------|
| 2.1.1 | `record_crud_test.go` | ~50 | ğŸ”´ | - |
| 2.1.2 | `collection_test.go` | ~30 | ğŸ”´ | - |
| 2.1.3 | `collection_import_test.go` | ~10 | ğŸ”´ | - |

**å°è®¡**: ~90 æµ‹è¯•å‡½æ•°

---

### 2.2 è®¤è¯æµ‹è¯• ğŸ”´

| # | æ–‡ä»¶ | æµ‹è¯•å‡½æ•°æ•° | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|------|-----------|------|---------|
| 2.2.1 | `record_auth_password_test.go` | ~15 | ğŸ”´ | - |
| 2.2.2 | `record_auth_with_oauth2_test.go` | ~20 | ğŸ”´ | - |
| 2.2.3 | `record_auth_otp_test.go` | ~10 | ğŸ”´ | - |
| 2.2.4 | `record_auth_refresh_test.go` | ~5 | ğŸ”´ | - |
| 2.2.5 | `record_auth_methods_test.go` | ~5 | ğŸ”´ | - |

**å°è®¡**: ~55 æµ‹è¯•å‡½æ•°

---

### 2.3 å…¶ä»– API æµ‹è¯• ğŸ”´

| # | æ–‡ä»¶ | æµ‹è¯•å‡½æ•°æ•° | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|------|-----------|------|---------|
| 2.3.1 | `batch_test.go` | ~10 | ğŸ”´ | - |
| 2.3.2 | `realtime_test.go` | ~8 | ğŸ”´ | - |
| 2.3.3 | `file_test.go` | ~10 | ğŸ”´ | - |
| 2.3.4 | `backup_test.go` | ~8 | ğŸ”´ | - |
| 2.3.5 | `settings_test.go` | ~5 | ğŸ”´ | - |
| 2.3.6 | `logs_test.go` | ~5 | ğŸ”´ | - |
| 2.3.7 | å…¶ä»– | ~9 | ğŸ”´ | - |

**å°è®¡**: ~25 æµ‹è¯•å‡½æ•°

---

**é˜¶æ®µäºŒæ€»è®¡**: 170 æµ‹è¯•å‡½æ•°

---

## é˜¶æ®µä¸‰ï¼šTools æ¨¡å— (343 æµ‹è¯•å‡½æ•°)

### 3.1 æ•°æ®åº“ç›¸å…³å·¥å…· ğŸ”´

| # | ç›®å½•/æ–‡ä»¶ | æµ‹è¯•å‡½æ•°æ•° | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|----------|-----------|------|---------|
| 3.1.1 | `tools/dbutils/` (å‰©ä½™) | ~20 | ğŸ”´ | - |
| 3.1.2 | `tools/search/` (å‰©ä½™) | ~35 | ğŸ”´ | - |
| 3.1.3 | `tools/subscriptions/` | ~20 | ğŸ”´ | - |

**å°è®¡**: ~75 æµ‹è¯•å‡½æ•°

---

### 3.2 è®¤è¯å·¥å…· (è¯„ä¼°æ˜¯å¦éœ€è¦) ğŸ”´

| # | ç›®å½• | æµ‹è¯•å‡½æ•°æ•° | éœ€è¦åŒæ•°æ®åº“ | çŠ¶æ€ |
|---|------|-----------|-------------|------|
| 3.2.1 | `tools/auth/` | ~80 | å¾…è¯„ä¼° | ğŸ”´ |

**æ³¨**: éœ€è¦é€ä¸ªåˆ†ææ˜¯å¦æ¶‰åŠæ•°æ®åº“æ“ä½œ

---

### 3.3 å…¶ä»–å·¥å…· (å¯èƒ½è·³è¿‡) âšª

| # | ç›®å½• | æµ‹è¯•å‡½æ•°æ•° | éœ€è¦åŒæ•°æ®åº“ | çŠ¶æ€ |
|---|------|-----------|-------------|------|
| 3.3.1 | `tools/filesystem/` | ~30 | å¦ | âšª |
| 3.3.2 | `tools/cron/` | ~15 | å¦ | âšª |
| 3.3.3 | `tools/security/` | ~20 | å¦ | âšª |
| 3.3.4 | `tools/types/` | ~30 | å¦ | âšª |
| 3.3.5 | `tools/hook/` | ~15 | å¦ | âšª |
| 3.3.6 | `tools/router/` | ~20 | å¦ | âšª |
| 3.3.7 | å…¶ä»– | ~58 | å¦ | âšª |

**å°è®¡**: ~188 æµ‹è¯•å‡½æ•° (å¯èƒ½è·³è¿‡)

---

**é˜¶æ®µä¸‰æ€»è®¡**: 343 æµ‹è¯•å‡½æ•° (å®é™…éœ€è¦è¿ç§»çº¦ 155)

---

## é˜¶æ®µå››ï¼šPlugins æ¨¡å— (148 æµ‹è¯•å‡½æ•°)

### 4.1 éœ€è¦åŒæ•°æ®åº“çš„æ’ä»¶ ğŸ”´

| # | æ’ä»¶ | æµ‹è¯•å‡½æ•°æ•° | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|------|-----------|------|---------|
| 4.1.1 | `plugins/jsvm/` | ~63 | ğŸ”´ | - |
| 4.1.2 | `plugins/migratecmd/` | ~20 | ğŸ”´ | - |
| 4.1.3 | `plugins/gateway/` | ~15 | ğŸ”´ | - |

**å°è®¡**: ~98 æµ‹è¯•å‡½æ•°

---

### 4.2 å¯èƒ½ä¸éœ€è¦çš„æ’ä»¶ (å¾…è¯„ä¼°) âšª

| # | æ’ä»¶ | æµ‹è¯•å‡½æ•°æ•° | éœ€è¦åŒæ•°æ®åº“ | çŠ¶æ€ |
|---|------|-----------|-------------|------|
| 4.2.1 | `plugins/ghupdate/` | ~20 | å¦ | âšª |
| 4.2.2 | `plugins/tofauth/` | ~30 | å¾…è¯„ä¼° | ğŸ”´ |

**å°è®¡**: ~50 æµ‹è¯•å‡½æ•°

---

**é˜¶æ®µå››æ€»è®¡**: 148 æµ‹è¯•å‡½æ•°

---

## é˜¶æ®µäº”ï¼šForms + Mails (17 æµ‹è¯•å‡½æ•°)

### 5.1 Forms æ¨¡å— ğŸ”´

| # | æ–‡ä»¶ | æµ‹è¯•å‡½æ•°æ•° | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|------|-----------|------|---------|
| 5.1.1 | `record_upsert_test.go` | ~8 | ğŸ”´ | - |
| 5.1.2 | å…¶ä»– | ~4 | ğŸ”´ | - |

**å°è®¡**: ~12 æµ‹è¯•å‡½æ•°

---

### 5.2 Mails æ¨¡å— (å¯èƒ½è·³è¿‡) âšª

| # | æ–‡ä»¶ | æµ‹è¯•å‡½æ•°æ•° | éœ€è¦åŒæ•°æ®åº“ | çŠ¶æ€ |
|---|------|-----------|-------------|------|
| 5.2.1 | `mails_test.go` | ~5 | å¦ | âšª |

**å°è®¡**: ~5 æµ‹è¯•å‡½æ•° (è·³è¿‡)

---

**é˜¶æ®µäº”æ€»è®¡**: 17 æµ‹è¯•å‡½æ•° (å®é™…éœ€è¦ 12)

---

## æ”¶å°¾é˜¶æ®µï¼šCI + æ–‡æ¡£ ğŸ”´

| # | ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆæ—¥æœŸ |
|---|------|------|---------|
| 6.1 | åˆ›å»º CI é…ç½® | ğŸ”´ | - |
| 6.2 | æ›´æ–° TESTING.md | ğŸ”´ | - |
| 6.3 | æ›´æ–° POSTGRESQL.md | ğŸ”´ | - |
| 6.4 | æ›´æ–° CONTRIBUTING.md | ğŸ”´ | - |
| 6.5 | æœ€ç»ˆéªŒè¯ | ğŸ”´ | - |

---

## å·²å®Œæˆä»»åŠ¡ ğŸŸ¢

| # | ä»»åŠ¡ | å®Œæˆæ—¥æœŸ |
|---|------|---------|
| 0.1 | æ–°å¢ `ApiScenario.TestBothDBs()` | 2026-01-30 |
| 0.2 | æ–°å¢ `ApiScenario.TestBothDBsParallel()` | 2026-01-30 |
| 0.3 | æ–°å¢ `ApiScenariosTestBothDBs()` | 2026-01-30 |
| 0.4 | åˆ›å»ºåŒæ•°æ®åº“æµ‹è¯•ç¤ºä¾‹ | 2026-01-30 |
| 0.5 | ä¿®å¤ `database_stats_test.go` | 2026-01-30 |
| 0.6 | åˆ›å»ºæµ‹è¯•åˆ†ææŠ¥å‘Š | 2026-01-30 |
| 1.1.1 | è¿ç§» `record_model_test.go` (14 ä¸ª DB æµ‹è¯•) | 2026-01-30 |
| 1.1.2 | è¿ç§» `collection_model_test.go` (7 ä¸ª DB æµ‹è¯•) | 2026-01-30 |
| 1.1.3 | è¿ç§» `record_query_test.go` (13 ä¸ª DB æµ‹è¯•) | 2026-01-30 |
| 1.1.4 | è¿ç§» `db_test.go` (3 ä¸ª DB æµ‹è¯•) | 2026-01-30 |
| 1.1.5 | è¿ç§» `log_query_test.go` (3 ä¸ª DB æµ‹è¯•) | 2026-01-30 |
| 1.1.6 | è¿ç§» `base_test.go` (4 ä¸ª DB æµ‹è¯•) | 2026-01-30 |
| 1.1.7 | è¿ç§» `db_tx_test.go` (6 ä¸ª DB æµ‹è¯•) | 2026-01-30 |
| 1.1.8 | è¿ç§» `collection_query_test.go` (9 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.1.9 | è¿ç§» `db_table_test.go` (10 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.2.1 | è¿ç§» `field_text_test.go` (7 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.2.2 | è¿ç§» `field_number_test.go` (6 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.2.3 | è¿ç§» `field_bool_test.go` (5 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.2.4 | è¿ç§» `field_date_test.go` (5 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.2.5 | è¿ç§» `field_file_test.go` (12 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.2.7 | è¿ç§» `field_select_test.go` (6 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.2.8 | è¿ç§» `field_json_test.go` (6 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.2.9 | è¿ç§» `field_email_test.go` (4 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.2.10 | è¿ç§» `field_url_test.go` (4 ä¸ªæµ‹è¯•) | 2026-01-30 |
| 1.2.11 | è¿ç§» `field_editor_test.go` (5 ä¸ªæµ‹è¯•) | 2026-01-30 |

---

## è¿›åº¦ç»Ÿè®¡

| é˜¶æ®µ | éœ€è¦è¿ç§» | å·²å®Œæˆ | è¿›è¡Œä¸­ | å¾…å¼€å§‹ | è·³è¿‡ | å®Œæˆç‡ |
|------|---------|-------|-------|-------|------|-------|
| æ¡†æ¶æ”¹è¿› | 6 | 6 | 0 | 0 | 0 | 100% |
| é˜¶æ®µä¸€ Core | 788 | 158 | 0 | 630 | 0 | 20.1% |
| é˜¶æ®µäºŒ APIs | 170 | 0 | 0 | 170 | 0 | 0% |
| é˜¶æ®µä¸‰ Tools | 343 | 12 | 0 | 143 | 188 | 3.5% |
| é˜¶æ®µå›› Plugins | 148 | 0 | 0 | 98 | 50 | 0% |
| é˜¶æ®µäº” Forms+Mails | 17 | 0 | 0 | 12 | 5 | 0% |
| æ”¶å°¾ | 5 | 0 | 0 | 5 | 0 | 0% |
| **æ€»è®¡** | **1,477** | **176** | **0** | **1,058** | **243** | **11.9%** |

**ç›®æ ‡è¿›åº¦**: 240/1549 â†’ 1549/1549 (15.5% â†’ 100%)

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… ~~**ç«‹å³**: å¼€å§‹ä»»åŠ¡ 1.1.1 - è¿ç§» `record_model_test.go`~~ (å·²å®Œæˆ)
2. âœ… ~~**ç»§ç»­**: å¼€å§‹ä»»åŠ¡ 1.1.2 - è¿ç§» `collection_model_test.go`~~ (å·²å®Œæˆ)
3. âœ… ~~**ç»§ç»­**: å¼€å§‹ä»»åŠ¡ 1.1.3 - è¿ç§» `record_query_test.go`~~ (å·²å®Œæˆ)
4. âœ… ~~**ç»§ç»­**: å¼€å§‹ä»»åŠ¡ 1.1.4 - è¿ç§» `db_test.go`~~ (å·²å®Œæˆ)
5. âœ… ~~**ç»§ç»­**: å¼€å§‹ä»»åŠ¡ 1.1.5 - è¿ç§» `log_query_test.go`~~ (å·²å®Œæˆ)
6. âœ… ~~**ç»§ç»­**: å¼€å§‹ä»»åŠ¡ 1.1.6 - è¿ç§» `base_test.go`~~ (å·²å®Œæˆ)
7. âœ… ~~**ç»§ç»­**: å¼€å§‹ä»»åŠ¡ 1.1.7 - è¿ç§» `db_tx_test.go`~~ (å·²å®Œæˆ)
8. âœ… ~~**ç»§ç»­**: å¼€å§‹ä»»åŠ¡ 1.1.8 - è¿ç§» `collection_query_test.go`~~ (å·²å®Œæˆ)
9. âœ… ~~**ç»§ç»­**: å¼€å§‹ä»»åŠ¡ 1.1.9 - è¿ç§» `db_table_test.go`~~ (å·²å®Œæˆ)
10. âœ… ~~**ç»§ç»­**: å¼€å§‹ä»»åŠ¡ 1.2.1 - è¿ç§» `field_text_test.go`~~ (å·²å®Œæˆ)
11. **ä¸‹ä¸€ä¸ª**: å¼€å§‹ä»»åŠ¡ 1.2.2 - è¿ç§» `field_number_test.go`
12. **æœ¬å‘¨**: å®Œæˆé˜¶æ®µä¸€å­—æ®µç±»å‹æµ‹è¯• (1.2.x)

---

## âš ï¸ å‘ç°çš„ä»£ç é—®é¢˜ï¼ˆéœ€è¦ä¿®å¤ï¼‰

åœ¨è¿ç§»æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ä»¥ä¸‹**ä»£ç å®ç°é—®é¢˜**ï¼ˆä¸ä»…ä»…æ˜¯æµ‹è¯•é—®é¢˜ï¼‰ï¼š

### é—®é¢˜ 1: `FindAuthRecordByEmail` ç¡¬ç¼–ç  SQLite è¯­æ³• ğŸŸ¢ å·²ä¿®å¤

**æ–‡ä»¶**: `core/record_query.go:555`

**é—®é¢˜æè¿°**:
```go
// åŸå®ç° - ç¡¬ç¼–ç  SQLite è¯­æ³•
expr = dbx.NewExp("[["+FieldNameEmail+"]] = {:email} COLLATE NOCASE", dbx.Params{"email": email})
```

**ä¿®å¤æ–¹æ¡ˆ**: ä½¿ç”¨ `DBAdapter().NoCaseCollation()` åˆ¤æ–­æ•°æ®åº“ç±»å‹
```go
collation := app.DBAdapter().NoCaseCollation()
if collation == "LOWER" {
    // PostgreSQL: WHERE LOWER(email) = LOWER(:email)
    expr = dbx.NewExp("LOWER([["+FieldNameEmail+"]]) = LOWER({:email})", dbx.Params{"email": email})
} else {
    // SQLite: WHERE email = :email COLLATE NOCASE
    expr = dbx.NewExp("[["+FieldNameEmail+"]] = {:email} "+collation, dbx.Params{"email": email})
}
```

**çŠ¶æ€**: ğŸŸ¢ å·²ä¿®å¤ (2026-01-30)

---

### é—®é¢˜ 2: `field_text.go` ç¡¬ç¼–ç  SQLite è¯­æ³• ğŸŸ¢ å·²ä¿®å¤

**æ–‡ä»¶**: `core/field_text.go:208`

**é—®é¢˜æè¿°**:
```go
// åŸå®ç° - ç¡¬ç¼–ç  SQLite è¯­æ³•
Where(dbx.NewExp("id = {:id} COLLATE NOCASE", dbx.Params{"id": newVal})).
```

**ä¿®å¤æ–¹æ¡ˆ**: åŒé—®é¢˜ 1ï¼Œä½¿ç”¨ `DBAdapter().NoCaseCollation()` åˆ¤æ–­

**çŠ¶æ€**: ğŸŸ¢ å·²ä¿®å¤ (2026-01-30)

---

### é—®é¢˜ 3: `initDataDB` æ²¡æœ‰æ­£ç¡®æ£€æŸ¥ `PostgresDSN` ğŸŸ¢ å·²ä¿®å¤

**æ–‡ä»¶**: `core/base.go:initDataDB()`

**é—®é¢˜æè¿°**:
åŸä»£ç æ£€æŸ¥ `app.DataDir()` æ˜¯å¦ä¸º PostgreSQL DSNï¼Œä½†å¿½ç•¥äº† `config.PostgresDSN` è®¾ç½®ã€‚

**ä¿®å¤æ–¹æ¡ˆ**: 
1. ä¼˜å…ˆæ£€æŸ¥ `app.config.PostgresDSN`
2. è‡ªåŠ¨æ ¹æ®æ•°æ®åº“ç±»å‹è®¾ç½® `DBAdapter`

**çŠ¶æ€**: ğŸŸ¢ å·²ä¿®å¤ (2026-01-30)

---

### é—®é¢˜ 4: AuxDB è¿ç§»é”™è¯¯ä½¿ç”¨ä¸»æ•°æ®åº“ç±»å‹åˆ¤æ–­ ğŸŸ¢ å·²ä¿®å¤

**æ–‡ä»¶**: 
- `migrations/1640988000_aux_init.go`
- `migrations/1736600000_system_metrics.go`

**é—®é¢˜æè¿°**:
AuxDBï¼ˆæ—¥å¿—æ•°æ®åº“ï¼‰å§‹ç»ˆä½¿ç”¨ SQLiteï¼Œä½†è¿™äº›è¿ç§»æ£€æŸ¥ `txApp.IsPostgres()` æ¥å†³å®š SQL è¯­æ³•ã€‚å½“ä¸»æ•°æ®åº“æ˜¯ PostgreSQL æ—¶ï¼Œä¼šå¯¹ SQLite AuxDB æ‰§è¡Œ PostgreSQL è¯­æ³•å¯¼è‡´é”™è¯¯ã€‚

**ä¿®å¤æ–¹æ¡ˆ**: ç§»é™¤ `IsPostgres()` åˆ¤æ–­ï¼Œå§‹ç»ˆä½¿ç”¨ SQLite è¯­æ³•

**çŠ¶æ€**: ğŸŸ¢ å·²ä¿®å¤ (2026-01-30)

---

### é—®é¢˜ 5: PostgreSQL æµ‹è¯•æ¡†æ¶ç¼ºå°‘æµ‹è¯•æ•°æ®å¯¼å…¥ ğŸ”´

**æ–‡ä»¶**: `tests/dual_db_test_helper.go`

**é—®é¢˜æè¿°**:
`NewPostgresTestApp()` åªè®¾ç½®äº† PostgreSQL DSNï¼Œä½†æ²¡æœ‰å¯¼å…¥æµ‹è¯•æ•°æ®åˆ° PostgreSQL æ•°æ®åº“ã€‚SQLite æµ‹è¯•ä½¿ç”¨å…‹éš†çš„ `data.db` æ–‡ä»¶ï¼Œä½† PostgreSQL éœ€è¦å•ç‹¬å¯¼å…¥æ•°æ®ã€‚

**å½±å“**:
- PostgreSQL æµ‹è¯•æ‰¾ä¸åˆ°æµ‹è¯•æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ã€collectionç­‰ï¼‰
- å¯¼è‡´ "no rows in result set" é”™è¯¯

**ä¿®å¤å»ºè®®**:
éœ€è¦åœ¨ `NewPostgresTestApp()` ä¸­æ·»åŠ æµ‹è¯•æ•°æ®å¯¼å…¥é€»è¾‘ï¼Œæˆ–è€…ä¿®æ”¹æµ‹è¯•æ•°æ®åˆå§‹åŒ–æ–¹å¼ã€‚

**çŠ¶æ€**: ğŸ”´ å¾…ä¿®å¤

---

## éªŒè¯å‘½ä»¤

```bash
# éªŒè¯å•ä¸ªæ–‡ä»¶è¿ç§»
TEST_POSTGRES=1 POSTGRES_DSN="..." go test ./core/... -v -run "TestRecordModel" -count 1

# éªŒè¯æ•´ä¸ªæ¨¡å—
TEST_POSTGRES=1 POSTGRES_DSN="..." go test ./core/... -count 1 -timeout 30m

# ç»Ÿè®¡ PostgreSQL æµ‹è¯•è¦†ç›–
grep -r "func Test" --include="*_test.go" . | wc -l  # æ€»æµ‹è¯•æ•°
grep -r "DualDBTest\|TestBothDBs\|Postgres\|PG" --include="*_test.go" . | wc -l  # PostgreSQL æµ‹è¯•æ•°
```
