# WebUI New Collection 功能验证方案

## 方案概述

本方案提供 **三层验证**，确保 webui 版本与 ui 版本功能完全对齐。

---

## 第一层：自动化验证（推荐先执行）

### 1.1 运行现有测试

```bash
cd webui
npm run test
```

预期结果：所有测试通过

### 1.2 TypeScript 类型检查

```bash
cd webui
npm run typecheck
```

预期结果：无类型错误

### 1.3 Lint 检查

```bash
cd webui
npm run lint
```

预期结果：无 lint 警告/错误

---

## 第二层：并排对比测试（核心验证）

### 2.1 环境准备

**终端 1 - 启动 PocketBase 后端：**
```bash
cd examples/base
go run main.go serve
```

**终端 2 - 启动 WebUI 开发服务器：**
```bash
cd webui
npm run dev
```

### 2.2 打开两个浏览器窗口

- **左侧窗口**：`http://localhost:3000/_/` （UI 版本 - 原版 Svelte）
- **右侧窗口**：`http://localhost:9000/` （WebUI 版本 - 新版 React）

### 2.3 执行对比测试

按照 `verification-checklist.md` 中的清单，**逐项对比两个版本**的行为。

#### 关键测试场景

| 场景 | 操作步骤 | 预期结果 |
|------|----------|----------|
| **创建 Base Collection** | 1. 点击 "New collection"<br>2. 输入名称 "test_base"<br>3. 添加一个 Text 字段<br>4. 保存 | 两个版本行为一致，保存成功 |
| **创建 Auth Collection** | 1. 选择 Auth 类型<br>2. 检查系统字段<br>3. 配置 OAuth2<br>4. 保存 | 系统字段完全一致（8个字段） |
| **创建 View Collection** | 1. 选择 View 类型<br>2. 输入 SQL 查询<br>3. 保存 | Query Tab 正常工作 |
| **编辑现有 Collection** | 1. 点击已有 Collection<br>2. 修改配置<br>3. 查看确认弹窗 | 变更检测和确认弹窗正常 |
| **字段类型测试** | 依次添加所有 15 种字段类型 | 每种字段的选项都完整 |
| **索引测试** | 添加普通索引和唯一索引 | 索引配置面板功能完整 |
| **规则测试** | 配置各种 API 规则 | 规则编辑器功能完整 |
| **快捷键测试** | 按 Ctrl+S、Escape 等 | 快捷键响应正常 |

---

## 第三层：边界条件测试

### 3.1 错误处理测试

| 测试项 | 操作 | 预期 |
|--------|------|------|
| 重复 Collection 名称 | 创建同名 Collection | 显示错误提示 |
| 无效字段名 | 输入 `123field`（数字开头）| 显示格式错误 |
| 重复字段名 | 添加两个同名字段 | 显示重复错误 |
| 空 Query | View Collection 不填 Query | 显示必填错误 |
| 无效规则语法 | 输入 `abc == 123` | 显示语法错误 |

### 3.2 性能测试

| 测试项 | 操作 | 预期 |
|--------|------|------|
| 大量字段 | 添加 50 个字段 | UI 响应正常，无卡顿 |
| 大量索引 | 添加 20 个索引 | 渲染正常 |
| 频繁切换 | 快速在 Tab 间切换 | 无闪烁，状态保持 |

### 3.3 特殊字符测试

| 测试项 | 输入 | 预期 |
|--------|------|------|
| 中文 Collection 名称 | `测试集合` | 显示格式错误（不支持中文）|
| 特殊字符字段名 | `field-1`, `field.1` | 显示格式错误 |
| Unicode 字段值 | Select 选项包含 emoji | 正常保存和显示 |

---

## 快速验证脚本

如果你想快速验证核心功能，可以按以下顺序执行：

### 5 分钟快速验证

```
1. [  ] 创建 Base Collection，添加一个 Text 字段 → 保存成功
2. [  ] 创建 Auth Collection → 检查 8 个系统字段存在
3. [  ] 创建 View Collection → Query Tab 可用
4. [  ] 编辑任意 Collection → 修改后显示确认弹窗
5. [  ] 按 Ctrl+S → 触发保存
6. [  ] 有未保存更改时按 Escape → 显示警告
```

### 15 分钟完整验证

```
1. [  ] 5 分钟快速验证的所有项目
2. [  ] 添加所有 15 种字段类型，检查各自选项
3. [  ] 配置 OAuth2 Provider（任选一个）
4. [  ] 配置 Token Options，点击 Invalidate 链接
5. [  ] 添加唯一索引和普通索引
6. [  ] 配置 API Rules，测试锁定/解锁
7. [  ] 测试 API Preview Tab
8. [  ] 输入错误值，检查错误提示
9. [  ] 删除 Collection，确认删除成功
```

---

## 问题报告模板

发现问题时，请按以下格式记录：

```markdown
### 问题 #XX

**严重程度**: P0/P1/P2
**功能模块**: [Fields/Rules/Indexes/Options/其他]
**问题描述**: 
[简述问题]

**复现步骤**:
1. ...
2. ...
3. ...

**预期行为**: 
[UI 版本的行为]

**实际行为**: 
[WebUI 版本的行为]

**截图**: 
[如有]
```

---

## 验证完成标准

✅ **功能完整性**：所有 UI 版本的功能在 WebUI 中都已实现
✅ **行为一致性**：相同操作在两个版本中产生相同结果
✅ **错误处理**：错误提示和验证逻辑一致
✅ **UI 细节**：样式、动画、响应式基本一致
✅ **无回归**：现有功能没有被破坏

---

## 下一步

1. 先执行 **5 分钟快速验证**
2. 如发现问题，记录并优先修复 P0 问题
3. 执行 **15 分钟完整验证**
4. 最后按照 `verification-checklist.md` 完整过一遍
