# Event Hooks

The standard way to modify PocketBase is through **event hooks** in your Go code.

All hooks have 3 main methods:

- **`Bind(handler)`** - adds a new handler to the specified event hook. A handler has 3 fields:
  - `Id` *(optional)* - the name of the handler (could be used as argument for `Unbind`)
  - `Priority` *(optional)* - the execution order of the handler (if empty fallbacks to the order of registration in the code)
  - `Func` *(required)* - the handler function

- **`BindFunc(func)`** - similar to `Bind` but registers a new handler from just the provided function. The registered handler is added with a default 0 priority and the id is autogenerated (the returned string value).

- **`Trigger(event, oneOffHandlerFuncs...)`** - triggers the event hook. *This method rarely has to be called manually by users.*

To remove an already registered hook handler, you can use the handler id and pass it to `Unbind(id)` or remove all handlers with `UnbindAll()` (*!including system handlers*).

::: info
All hook handler functions share the same `func(e T) error` signature and expect the user to call `e.Next()` if they want to proceed with the execution chain.

**If you need to access the app instance from inside a hook handler, prefer using the `e.App` field instead of reusing a parent scope app variable because the hook could be part of a DB transaction and can cause deadlock.**

Also avoid using global mutex locks inside a hook handler because it could be invoked recursively (e.g. cascade delete) and can cause deadlock.
:::

## App Hooks

### OnServe

Triggered when the app is started via `app.Start()`.

```go
app.OnServe().BindFunc(func(se *core.ServeEvent) error {
    // register custom routes, middlewares, etc.
    return se.Next()
})
```

### OnBootstrap

Triggered when the app is bootstrapped.

```go
app.OnBootstrap().BindFunc(func(e *core.BootstrapEvent) error {
    // custom initialization logic
    return e.Next()
})
```

## Record Hooks

### OnRecordCreate

Triggered when a new record is created.

```go
app.OnRecordCreate("posts").BindFunc(func(e *core.RecordEvent) error {
    // e.Record contains the record being created
    return e.Next()
})
```

### OnRecordUpdate

Triggered when a record is updated.

```go
app.OnRecordUpdate("posts").BindFunc(func(e *core.RecordEvent) error {
    // e.Record contains the record being updated
    return e.Next()
})
```

### OnRecordDelete

Triggered when a record is deleted.

```go
app.OnRecordDelete("posts").BindFunc(func(e *core.RecordEvent) error {
    // e.Record contains the record being deleted
    return e.Next()
})
```

### OnRecordCreateRequest

Triggered on record create API request.

```go
app.OnRecordCreateRequest("posts").BindFunc(func(e *core.RecordRequestEvent) error {
    // if not superuser, overwrite the newly submitted "posts" record status to pending
    if !e.HasSuperuserAuth() {
        e.Record.Set("status", "pending")
    }
    return e.Next()
})
```

### OnRecordUpdateRequest

Triggered on record update API request.

```go
app.OnRecordUpdateRequest("posts").BindFunc(func(e *core.RecordRequestEvent) error {
    // custom validation or modification
    return e.Next()
})
```

### OnRecordDeleteRequest

Triggered on record delete API request.

```go
app.OnRecordDeleteRequest("posts").BindFunc(func(e *core.RecordRequestEvent) error {
    // custom validation before delete
    return e.Next()
})
```

### OnRecordEnrich

Triggered on every record enriching (list, view, create, update, realtime change, etc.).

```go
app.OnRecordEnrich("articles").BindFunc(func(e *core.RecordEnrichEvent) error {
    // dynamically show/hide a record field
    if e.RequestInfo.Auth == nil || !e.RequestInfo.Auth.IsSuperuser() {
        e.Record.Hide("someSecretField")
    }
    return e.Next()
})
```

For a complete list of available hooks, please refer to the [PocketBase Go documentation](https://pkg.go.dev/github.com/pocketbase/pocketbase).
